<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Enigma Machine - 10 Rotors</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    color: #fff;
  }

  .container {
    background: rgba(15, 23, 42, 0.95);
    backdrop-filter: blur(20px);
    border-radius: 25px;
    padding: 40px;
    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
    max-width: 1200px;
    width: 100%;
    animation: fadeIn 0.8s ease-out;
    border: 1px solid rgba(255, 255, 255, 0.1);
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

 h1 {
  text-align: center;
  margin-bottom: 14px;
  font-size: 3em;
  font-weight: 800;
  letter-spacing: 1px;

  color: #ffffff;

  text-shadow:
    0 2px 8px rgba(0,0,0,0.7),
    0 0 20px rgba(255,255,255,0.25);
}




  .subtitle {
    text-align: center;
    color: #94a3b8;
    margin-bottom: 30px;
    font-size: 1.1em;
  }

  .main-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
  }

  @media (max-width: 768px) {
    .main-grid {
      grid-template-columns: 1fr;
    }
  }

  .section {
    background: rgba(30, 41, 59, 0.8);
    border-radius: 20px;
    padding: 25px;
    border: 1px solid rgba(148, 163, 184, 0.2);
    backdrop-filter: blur(10px);
  }

  .section-title {
    font-weight: 700;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.2em;
    color: #e2e8f0;
  }

  .icon {
    width: 24px;
    height: 24px;
    display: inline-block;
  }

  .bit-inputs {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }

  @media (max-width: 768px) {
    .bit-inputs {
      flex-wrap: nowrap;
      gap: 8px;
      padding: 0 10px;
      justify-content: flex-start;
    }
  }

  input {
    width: 55px;
    height: 55px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
    border: 2px solid rgba(148, 163, 184, 0.3);
    border-radius: 12px;
    transition: all 0.3s ease;
    background: rgba(15, 23, 42, 0.8);
    color: #60a5fa;
  }

  #initialCapital {
    width: 200px;
    height: 50px;
    font-size: 18px;
    padding: 0 15px;
    cursor: text;
    background: rgba(30, 41, 59, 0.9);
    border: 2px solid rgba(96, 165, 250, 0.5);
    color: #e2e8f0;
  }

  #initialCapital:focus {
    border-color: #60a5fa;
    outline: none;
    box-shadow: 0 0 15px rgba(96, 165, 250, 0.3);
    background: rgba(30, 41, 59, 1);
  }

  #setCapital {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
  }

  #setCapital.capital-button-pulse {
    animation: capitalButtonPulse 2s ease-in-out infinite;
  }

  @keyframes capitalButtonPulse {
    0%, 100% { 
      transform: translateY(-2px) scale(1); 
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }
    50% { 
      transform: translateY(-2px) scale(1.05); 
      box-shadow: 0 12px 30px rgba(16, 185, 129, 0.5);
    }
  }

  @media (max-width: 768px) {
    input.in {
      width: 50px;
      height: 50px;
      font-size: 18px;
      flex-shrink: 0;
    }
  }

  input.in {
    cursor: pointer;
    border-color: rgba(96, 165, 250, 0.5);
  }

  input.in.disabled {
    cursor: not-allowed !important;
    background: rgba(51, 65, 85, 0.8);
    border-color: rgba(148, 163, 184, 0.2);
    color: #64748b;
  }

  .multiplier-input:disabled {
    cursor: not-allowed !important;
    background: rgba(51, 65, 85, 0.8);
    border-color: rgba(148, 163, 184, 0.2);
    color: #64748b;
  }

  .multiplier-input:not(:disabled) {
    cursor: pointer;
  }

  input.in:focus {
    border-color: #60a5fa;
    outline: none;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
    background: rgba(30, 41, 59, 0.9);
  }

  input.auto-out {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
    cursor: pointer;
    border-color: rgba(16, 185, 129, 0.5);
    font-weight: bold;
  }

  input.auto-out.lucky-input {
    cursor: text;
    background: rgba(245, 158, 11, 0.2);
    color: #f59e0b;
    border-color: rgba(245, 158, 11, 0.5);
  }

  input.auto-out.lucky-input:focus {
    border-color: #f59e0b;
    outline: none;
    transform: scale(1.1);
    box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
    background: rgba(245, 158, 11, 0.3);
  }

  input.auto-out.match {
    background: rgba(251, 191, 36, 0.3);
    color: #f59e0b;
    border-color: rgba(251, 191, 36, 0.7);
    box-shadow: 0 0 15px rgba(251, 191, 36, 0.4);
    animation: matchPulse 1s ease-in-out;
  }

  @keyframes matchPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

  input.out {
    background: rgba(51, 65, 85, 0.8);
    color: #a78bfa;
    cursor: not-allowed;
    border-color: rgba(167, 139, 250, 0.5);
  }

  .control-panel {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 25px;
  }

  .control-group {
    background: rgba(30, 41, 59, 0.6);
    padding: 15px;
    border-radius: 12px;
    border: 1px solid rgba(148, 163, 184, 0.2);
  }

  .control-label {
    font-size: 0.9em;
    color: #94a3b8;
    margin-bottom: 8px;
    font-weight: 600;
  }

  select, input[type="number"], input[type="text"] {
    width: 100%;
    padding: 8px 12px;
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(148, 163, 184, 0.3);
    border-radius: 8px;
    color: #e2e8f0;
    font-size: 14px;
  }

  select:focus, input[type="number"]:focus, input[type="text"]:focus {
    outline: none;
    border-color: #60a5fa;
    box-shadow: 0 0 10px rgba(96, 165, 250, 0.2);
  }

  .button-group {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin: 30px 0;
    flex-wrap: wrap;
  }

  button {
    font-size: 14px;
    font-weight: 700;
    padding: 12px 25px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: relative;
    overflow: hidden;
  }

  button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
  }

  button:hover::before {
    left: 100%;
  }

  .btn-primary {
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
  }

  .btn-primary.play-pulse {
    animation: playButtonPulse 1s ease-in-out infinite;
    font-size: 16px;
    padding: 14px 30px;
    min-width: 150px;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    border: 2px solid #f87171;
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
  }

  @keyframes playButtonPulse {
    0%, 100% { 
      transform: scale(1); 
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.6);
      background: linear-gradient(135deg, #ef4444, #dc2626);
      border-color: #f87171;
    }
    50% { 
      transform: scale(1.1); 
      box-shadow: 0 12px 40px rgba(239, 68, 68, 0.9);
      background: linear-gradient(135deg, #dc2626, #b91c1c);
      border-color: #fca5a5;
    }
  }

  .bet-prompt {
    animation: betPromptPulse 1s ease-in-out infinite;
    will-change: transform, opacity, filter;
    backface-visibility: hidden;
    transform: translateZ(0);
  }

  /* áº¨n cÃ¡c há»™p khÃ´ng cáº§n thiáº¿t */
  .control-panel {
    display: none !important;
  }
  
  .process-flow {
    display: none !important;
  }
  
  .button-group {
    display: none !important;
  }
  
  #info {
    display: none !important;
  }
  
  .section:not(.capital-section):not(.game-info-section) {
    display: none !important;
  }
  
  /* áº¨n thÃªm statistics vÃ  operation history */
  .section:has(.stat-item),
  .section:has(#history),
  .section:has(.stats-grid),
  .section:has(.history-panel) {
    display: none !important;
  }
  
  /* áº¨n rotor states */
  .section:has(.rotor-grid) {
    display: none !important;
  }
  
  /* áº¨n main-grid thá»© hai (chá»©a statistics vÃ  operation history) */
  .main-grid:nth-of-type(2) {
    display: none !important;
  }
  
  /* áº¨n táº¥t cáº£ cÃ¡c section sau main-grid Ä‘áº§u tiÃªn */
  .container > .main-grid:nth-of-type(2),
  .container > .section:not(.capital-section):not(.game-info-section) {
    display: none !important;
  }
  
  /* áº¨n main-grid thá»© hai vÃ  táº¥t cáº£ ná»™i dung bÃªn trong */
  .container > .main-grid:nth-of-type(2),
  .container > .main-grid:nth-of-type(2) > .section,
  .container > .main-grid:nth-of-type(2) .stats-grid,
  .container > .main-grid:nth-of-type(2) .history-panel {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    overflow: hidden !important;
  }
  
  /* áº¨n cá»¥ thá»ƒ cÃ¡c pháº§n khÃ´ng cáº§n thiáº¿t */
  .section:has(.rotor-grid),
  .section:has(.stats-grid),
  .section:has(.history-panel),
  .section:has(#history) {
    display: none !important;
  }
  
  /* áº¨n Táº¤T Cáº¢ cÃ¡c pháº§n sau game-info-section */
  .game-info-section ~ * {
    display: none !important;
    visibility: hidden !important;
    height: 0 !important;
    overflow: hidden !important;
    position: absolute !important;
    top: -9999px !important;
    left: -9999px !important;
  }
  
  /* Chá»‰ hiá»ƒn thá»‹ 4 há»™p chÃ­nh */
  .capital-section,
  .game-info-section,
  .main-grid .section:nth-child(1),
  .main-grid .section:nth-child(2) {
    display: block !important;
    visibility: visible !important;
    height: auto !important;
    position: static !important;
    top: auto !important;
    left: auto !important;
  }
  
  /* CÄƒn giá»¯a 4 há»™p chÃ­nh */
  .main-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 20px;
  max-width: 90%;
  margin: 0 auto;
}
  .capital-section {
    grid-column: 1 / -1;
    margin-bottom: 20px;
  }

  @keyframes betPromptPulse {
    0%, 100% { 
      opacity: 1;
      transform: scale(1) translateY(0) translateZ(0);
      text-shadow: 0 0 15px rgba(255, 0, 100, 1), 0 0 30px rgba(255, 0, 100, 0.8);
      filter: brightness(1.2) saturate(1.5);
      color: #ff0064;
      box-shadow: 0 4px 15px rgba(245, 158, 11, 0.6);
    }
    50% { 
      opacity: 0.8;
      transform: scale(1.1) translateY(-4px) translateZ(0);
      text-shadow: 0 0 25px rgba(255, 0, 100, 1), 0 0 50px rgba(255, 0, 100, 0.8);
      filter: brightness(1.6) saturate(2);
      color: #ff0064;
      box-shadow: 0 12px 40px rgba(245, 158, 11, 0.9);
    }
  }

  .btn-secondary {
    background: linear-gradient(135deg, #10b981, #06b6d4);
    color: white;
  }

  .btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
  }

  .btn-danger {
  background: linear-gradient(135deg, #ef4444, #f97316);
  color: white;

   font-size: 1em;
  padding: 0.8em 1.4em;
  
  min-width: clamp(40px, 20vw, 100px);
   line-height: 1.2;
  padding: 0.8em 1.4em;
  height: auto;
  
  border-radius: 10px;
  border: 2px solid rgba(239, 68, 68, 0.5);
  display: block;
  margin: 40px auto 0;
}

  .btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(239, 68, 68, 0.4);
  }

  #info {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
    border-radius: 15px;
    font-family: 'Courier New', monospace;
    font-weight: 600;
    color: #e2e8f0;
    margin: 20px 0;
    border: 2px solid rgba(96, 165, 250, 0.3);
    font-size: 1.1em;
  }

  .rotor-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    gap: 10px;
    margin-top: 20px;
  }

  .rotor-item {
    text-align: center;
    padding: 12px;
    background: rgba(30, 41, 59, 0.8);
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.2);
    transition: all 0.3s ease;
  }

  .rotor-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(96, 165, 250, 0.2);
    border-color: rgba(96, 165, 250, 0.4);
  }

  .rotor-name {
    font-weight: bold;
    color: #60a5fa;
    margin-bottom: 5px;
    font-size: 0.9em;
  }

  .rotor-value {
    font-family: 'Courier New', monospace;
    color: #a78bfa;
    font-size: 0.85em;
  }

  .history-panel {
    max-height: 200px;
    overflow-y: auto;
    background: rgba(15, 23, 42, 0.8);
    border-radius: 10px;
    padding: 15px;
    border: 1px solid rgba(148, 163, 184, 0.2);
  }

  .history-item {
    padding: 8px;
    margin: 5px 0;
    background: rgba(30, 41, 59, 0.6);
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
    color: #94a3b8;
    border-left: 3px solid #60a5fa;
  }

  .process-flow {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin: 20px 0;
    flex-wrap: wrap;
  }

  .process-step {
    padding: 8px 15px;
    background: rgba(59, 130, 246, 0.2);
    border: 1px solid rgba(96, 165, 250, 0.4);
    border-radius: 20px;
    font-size: 0.85em;
    color: #60a5fa;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  .arrow {
    color: #a78bfa;
    font-weight: bold;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 20px;
  }

  .stat-item {
    text-align: center;
    padding: 15px;
    background: rgba(30, 41, 59, 0.6);
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.2);
  }

  .stat-value {
    font-size: 1.5em;
    font-weight: bold;
    color: #60a5fa;
  }

  .stat-label {
    font-size: 0.85em;
    color: #94a3b8;
    margin-top: 5px;
  }

  .capital-section {
    background: rgba(30, 41, 59, 0.8);
    border-radius: 20px;
    padding: 20px;
    border: 1px solid rgba(148, 163, 184, 0.2);
    margin-bottom: 20px;
    text-align: center;
  }

  .capital-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    margin-top: 15px;
  }

  @media (max-width: 768px) {
    .capital-controls {
      flex-direction: column;
      gap: 15px;
      align-items: stretch;
    }

    .capital-input-group {
      order: 1;
    }

    .capital-displays {
      order: 2;
      flex-direction: column;
      gap: 10px;
    }
  }

  .capital-input-group {
    display: flex;
    gap: 10px;
    align-items: center;
    justify-content: center;
  }

  @media (max-width: 768px) {
    .capital-input-group {
      flex-direction: column;
      gap: 15px;
    }

    .capital-input-group input {
      width: 100%;
      max-width: 300px;
    }

    #startBetting {
      width: 100%;
      max-width: 200px;
      margin-bottom: 35px;
    }
  }

  .capital-input-group input {
    width: 200px;
    padding: 10px;
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(148, 163, 184, 0.3);
    border-radius: 8px;
    color: #e2e8f0;
    font-size: 16px;
  }

  .capital-displays {
    display: flex;
    gap: 15px;
    align-items: flex-start;
  }

  @media (max-width: 768px) {
    .capital-displays {
      flex-direction: column;
      gap: 10px;
      width: 100%;
    }

    .capital-displays > div {
      width: 100%;
    }

    .capital-display, .profit-display {
      width: 100%;
      min-width: auto;
      max-width: 300px;
      margin: 0 auto;
    }
  }

  .capital-displays > div {
    flex: 1;
  }

  .display-label {
    font-size: 0.9em;
    color: #94a3b8;
    text-align: center;
    margin-bottom: 5px;
    font-weight: 600;
  }

  .capital-display {
    font-size: 2em;
    font-weight: bold;
    color: #10b981;
    text-align: center;
    padding: 15px;
    background: rgba(16, 185, 129, 0.1);
    border-radius: 12px;
    border: 2px solid rgba(16, 185, 129, 0.3);
    min-width: 200px;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .profit-display {
    font-size: 2em;
    font-weight: bold;
    color: #f59e0b;
    text-align: center;
    padding: 15px;
    background: rgba(245, 158, 11, 0.1);
    border-radius: 12px;
    border: 2px solid rgba(245, 158, 11, 0.3);
    min-width: 200px;
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .profit-display.positive {
    color: #10b981;
    background: rgba(16, 185, 129, 0.1);
    border-color: rgba(16, 185, 129, 0.3);
  }

  .profit-display.negative {
    color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
    border-color: rgba(239, 68, 68, 0.3);
  }

  .input-betting-section {
    margin-bottom: 20px;
  }

  .output-section, .auto-input-section {
    margin-bottom: 20px;
  }

  .game-info-section {
    margin-bottom: 30px;
  }

  .multiplier-inputs {
    display: flex;
    gap: 8px;
    align-items: center;
    justify-content: center;
    flex-wrap: nowrap;
    margin-bottom: 20px;
  }

  .multiplier-input {
    width: 50px;
    height: 38px;
    text-align: center;
    font-size: 14px;
    font-weight: bold;
    border: 2px solid rgba(148, 163, 184, 0.3);
    border-radius: 8px;
    background: rgba(15, 23, 42, 0.8);
    color: #f59e0b;
    transition: all 0.3s ease;
  }

  .multiplier-input:focus {
    border-color: #f59e0b;
    outline: none;
    transform: scale(1.05);
    box-shadow: 0 0 15px rgba(245, 158, 11, 0.3);
  }

  #startBetting {
    margin-bottom: 35px;
  }

  .x1000-display {
    font-size: 1.2em;
    font-weight: bold;
    color: #ef4444;
    margin-left: 10px;
    padding: 8px 15px;
    background: rgba(239, 68, 68, 0.2);
    border-radius: 8px;
    border: 1px solid rgba(239, 68, 68, 0.4);
  }

  .betting-history {
    max-height: 150px;
    overflow-y: auto;
    background: rgba(15, 23, 42, 0.8);
    border-radius: 10px;
    padding: 15px;
    border: 1px solid rgba(148, 163, 184, 0.2);
    margin-top: 15px;
  }

  .bet-history-item {
    padding: 8px;
    margin: 5px 0;
    background: rgba(30, 41, 59, 0.6);
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: 0.9em;
    border-left: 3px solid #f59e0b;
  }

  .bet-history-item.win {
    border-left-color: #10b981;
    background: rgba(16, 185, 129, 0.1);
  }

  .bet-history-item.lose {
    border-left-color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
  }

  .game-status {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.1));
    border-radius: 12px;
    font-weight: bold;
    margin: 15px 0;
    border: 2px solid rgba(245, 158, 11, 0.3);
    font-size: 1.2em;
    transition: all 0.3s ease;
    width: auto;
    max-width: 100%;
  }

  /* Class cho thÃ´ng bÃ¡o rá»™ng 90% */
  .game-status.wide-notification {
    width: 90%;
    max-width: 90%;
    margin: 15px auto;
  }

  .game-status.success-pulse {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(5, 150, 105, 0.4));
    border: 3px solid #10b981;
    color: #ffffff;
    font-size: 1.4em;
    animation: successPulse 1.2s ease-in-out infinite;
    box-shadow: 0 0 40px rgba(16, 185, 129, 0.8);
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.9);
    position: relative;
    overflow: hidden;
  }

  .game-status.success-pulse::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
    animation: shimmer 2s linear infinite;
  }

  @keyframes successPulse {
    0%, 100% { 
      transform: scale(1); 
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.8);
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.4), rgba(5, 150, 105, 0.4));
    }
    25% { 
      transform: scale(1.05); 
      box-shadow: 0 0 60px rgba(16, 185, 129, 1);
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.6), rgba(5, 150, 105, 0.6));
    }
    50% { 
      transform: scale(1.08); 
      box-shadow: 0 0 80px rgba(16, 185, 129, 1.2);
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.7), rgba(5, 150, 105, 0.7));
    }
    75% { 
      transform: scale(1.05); 
      box-shadow: 0 0 60px rgba(16, 185, 129, 1);
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.6), rgba(5, 150, 105, 0.6));
    }
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
  }

  .game-status.play-prompt {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(29, 78, 216, 0.3));
    border: 3px solid #3b82f6;
    color: #ffffff;
    font-size: 1.3em;
    animation: playPromptPulse 1s ease-in-out infinite;
    box-shadow: 0 0 25px rgba(59, 130, 246, 0.6);
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
  }

  @keyframes warningPulse {
    0%, 100% { 
      transform: scale(1); 
      box-shadow: 0 0 30px rgba(239, 68, 68, 0.6);
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.3), rgba(185, 28, 28, 0.3));
    }
    50% { 
      transform: scale(1.08); 
      box-shadow: 0 0 50px rgba(239, 68, 68, 0.8);
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.5), rgba(185, 28, 28, 0.5));
    }
  }

  @keyframes playPromptPulse {
    0%, 100% { 
      transform: scale(1); 
      box-shadow: 0 0 25px rgba(59, 130, 246, 0.6);
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(29, 78, 216, 0.3));
    }
    50% { 
      transform: scale(1.06); 
      box-shadow: 0 0 40px rgba(59, 130, 246, 0.8);
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.5), rgba(29, 78, 216, 0.5));
    }
  }

  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(30, 41, 59, 0.8);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb {
    background: rgba(96, 165, 250, 0.5);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: rgba(96, 165, 250, 0.7);
  }

  /* XÃ³a mÅ©i tÃªn trong Ã´ input type="number */
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    appearance: none;
    margin: 0;
  }
  
  input[type="number"] {
    -moz-appearance: textfield;
    appearance: textfield;
  }

  /* Hiá»‡u á»©ng nháº¥p nhÃ¡y cho cursor */
  @keyframes cursorBlink {
    0%, 100% { 
      box-shadow: 0 0 5px rgba(96, 165, 250, 0.3);
      border-color: rgba(96, 165, 250, 0.5);
    }
    50% { 
      box-shadow: 0 0 20px rgba(96, 165, 250, 0.8), 0 0 30px rgba(96, 165, 250, 0.4);
      border-color: #60a5fa;
      transform: scale(1.02);
    }
  }

  .cursor-blink-active {
    animation: cursorBlink 1.5s ease-in-out infinite;
  }

  /* Hiá»‡u á»©ng nháº¥p nhÃ¡y cho thÃ´ng bÃ¡o vá»‘n khÃ´ng Ä‘á»§ */
  .insufficient-funds-pulse {
    animation: insufficientFundsPulse 1.5s ease-in-out infinite;
  }

  @keyframes insufficientFundsPulse {
    0%, 100% { 
      transform: scale(1); 
      box-shadow: 0 0 25px rgba(245, 158, 11, 0.7);
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(251, 191, 36, 0.3));
      border-color: #f59e0b;
    }
    50% { 
      transform: scale(1.08); 
      box-shadow: 0 0 45px rgba(245, 158, 11, 1);
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.5), rgba(251, 191, 36, 0.5));
      border-color: #fbbf24;
    }
  }
</style>
</head>
<body>

<div class="container">
  <h1>ğŸš€ CUá»˜C CHIáº¾N SINH Tá»¬ ğŸ“¡</h1>
    <p class="subtitle">Há»‡ thá»‘ng phÃ²ng thá»§ chiáº¿n lÆ°á»£c Ä‘Ã£ vÃ o vá»‹ trÃ­ sáºµn sÃ ng chiáº¿n Ä‘áº¥u ğŸš€ğŸš€ğŸš€ ğŸ“¡ğŸ“¡ğŸ“¡ </p>

  <div class="control-panel">
    <div class="control-group">
      <div class="control-label">ğŸ”§ Encryption Mode</div>
      <select id="mode">
        <option value="ecb">ECB (Electronic Codebook)</option>
        <option value="cbc">CBC (Cipher Block Chaining)</option>
        <option value="ctr">CTR (Counter)</option>
        <option value="chain">Chain Mode</option>
      </select>
    </div>
    <div class="control-group">
      <div class="control-label">ğŸ”„ Rounds</div>
      <input type="number" id="rounds" min="1" max="10" value="3">
    </div>
    <div class="control-group">
      <div class="control-label">ğŸ”‘ Key (Hex)</div>
      <input type="text" id="customKey" value="C0FFEE99" maxlength="8">
    </div>
    <div class="control-group">
      <div class="control-label">ğŸ“Š IV (Hex)</div>
      <input type="text" id="customIV" value="12345678" maxlength="8">
    </div>
  </div>

  
  <!-- Capital Display Section -->
  <div class="capital-section">
    <div class="section-title">
      <span class="icon">ğŸ’°</span>
      Tá»•ng sá»‘ tÃªn lá»­a trong kho bÃ­ máº­t
    </div>
    <div class="capital-controls">
      <div class="capital-input-group">
        <input type="text" id="initialCapital" placeholder="Nháº­p Sá»‘ lÆ°á»£ng tÃªn lá»­a ban Ä‘áº§u">
        <button id="setCapital" class="btn-secondary">ğŸ’° Nháº­p Sá»‘ lÆ°á»£ng tÃªn lá»­a</button>
      </div>
      <div class="capital-displays">
        <div>
          <div class="display-label">Trong kho cÃ²n</div>
          <div class="capital-display" id="currentCapital">0</div>
        </div>
        <div>
          <div class="display-label">Sá»‘ lÆ°á»£ng tÃªn lá»­a</div>
          <div class="profit-display" id="profitDisplay">0</div>
        </div>
      </div>
    </div>
  </div>



 <div class="game-status" id="gameStatus">
      ğŸ¯ Sáºµn sÃ ng phÃ³ng TÃªn Lá»­a - Nháº­p tá»a Ä‘á»™ Ä‘á»ƒ báº¯t Ä‘áº§u
    </div>

  <!-- Input and Betting Section -->
  <div class="main-grid">
    <div class="section">
    
     <div class="section-title" style="margin: 20px;">
        <span class="icon">ğŸš€</span>
        Tá»a Ä‘á»™ tÃªn lá»­a (x1000)
      </div>
      <div class="multiplier-inputs">
        <input type="number" class="multiplier-input" id="mult1" inputmode="numeric">
        <input type="number" class="multiplier-input" id="mult2" inputmode="numeric">
        <input type="number" class="multiplier-input" id="mult3" inputmode="numeric">
        <input type="number" class="multiplier-input" id="mult4" inputmode="numeric">
        <input type="number" class="multiplier-input" id="mult5" inputmode="numeric">
      </div>
   
<div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 35px;">
  <button id="startBetting" class="btn-primary play-pulse">ğŸ® Play</button>
   

  </div>
        
      <div class="section-title">
        <span class="icon">ğŸ“¡</span>
       Nháº­p tá»a Ä‘á»™ má»¥c tiÃªu:
      </div>
      
      <div class="bit-inputs">
        <input class="in" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
        <input class="in" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
        <input class="in" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
        <input class="in" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
        <input class="in" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
      </div>
       </div>

     
    <div class="section">
      <div class="section-title">
        <span class="icon">ğŸ“¡</span>
       Tá»a Ä‘á»™ Ä‘Ã£ mÃ£ hÃ³a
      </div>
      <div class="bit-inputs">
        <input class="out" readonly>
        <input class="out" readonly>
        <input class="out" readonly>
        <input class="out" readonly>
        <input class="out" readonly>
      </div>
      
      <div class="section-title" style="margin-top: 20px;">
        <span class="icon">ğŸ”„</span>
      Tá»ŒA Äá»˜ may máº¯n
       <span style="display:block;text-align:center;font-size:0.8em;color:#f59e0b;margin-top:6px;">ğŸŸ¡ TRÃšNG Má»¤C TIÃŠU </span>
      </div>
      
     
       
      
      <div class="bit-inputs">
        <input class="auto-out lucky-input" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
        <input class="auto-out lucky-input" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
        <input class="auto-out lucky-input" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
        <input class="auto-out lucky-input" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
        <input class="auto-out lucky-input" maxlength="1" placeholder="0/1" inputmode="numeric" pattern="[01]">
      </div>
     <button id="reset" class="btn-danger">ğŸ”„ Reset Cuá»™c Chiáº¿n</button>
    </div>
    
  </div>

  <!-- Game Status and History -->
  <div class="game-info-section">
       
    <div class="betting-history" id="bettingHistory">
      <div class="bet-history-item">Há»‡ thá»‘ng tÃªn lá»­a 28 SARMART Ä‘Ã£ sáºµn sÃ ng</div>
    </div>
  </div>

  <div class="process-flow" id="processFlow">
    <div class="process-step">Input</div>
    <span class="arrow">â†’</span>
    <div class="process-step">Permutation</div>
    <span class="arrow">â†’</span>
    <div class="process-step">Rotor 1-10</div>
    <span class="arrow">â†’</span>
    <div class="process-step">Final Mix</div>
    <span class="arrow">â†’</span>
    <div class="process-step">Output</div>
  </div>

  <div class="button-group">
       <button id="encrypt" class="btn-primary">ğŸ” Encrypt</button>
    <button id="decrypt" class="btn-secondary">ğŸ”“ Decrypt</button>
        <button id="export" class="btn-primary">ğŸ’¾ Export State</button>
    <button id="import" class="btn-secondary">ğŸ“‚ Import State</button>
  </div>

  <div id="info">Advanced Enigma Ready - 10 Rotors Active</div>

  <div class="section">
    <div class="section-title">
      <span class="icon">âš™ï¸</span>
      Rotor States (Real-time)
    </div>
    <div class="rotor-grid" id="rotorGrid">
      <!-- Rotor states will be populated here -->
    </div>
  </div>

  <div class="main-grid">
    <div class="section">
      <div class="section-title">
        <span class="icon">ğŸ“ˆ</span>
        Statistics
      </div>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value" id="totalOps">0</div>
          <div class="stat-label">Total Operations</div>
        </div>
        
        <div class="stat-item">
          <div class="stat-value" id="cycles">0</div>
          <div class="stat-label">Key Cycles</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="diffusion">0%</div>
          <div class="stat-label">Diffusion Rate</div>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="section-title">
        <span class="icon">ğŸ“œ</span>
        Operation History
      </div>
      <div class="history-panel" id="history">
        <div class="history-item">System initialized - Advanced Enigma ready</div>
      </div>
    </div>
  </div>
</div>

<script>
/* ======= ADVANCED ENIGMA MACHINE ======= */


// Betting system variables
let currentCapital = 0;
let initialCapital = 0;
let bettingActive = false;
let bettingHistory = [];
let currentBetRound = 0;
let baseBetAmount = 1000;
let roundProfit = 0; // LÃ£i cá»§a round hiá»‡n táº¡i
let profitThresholdReached = false; // ÄÃ£ Ä‘áº¡t ngÆ°á»¡ng lÃ£i 20%
let fromLuckyInputs = false; // ÄÃ¡nh dáº¥u nguá»“n gá»i processBetting

// DOM elements
const inputs = document.querySelectorAll(".in");
const autoOuts = document.querySelectorAll(".auto-out");
const luckyInputs = document.querySelectorAll(".lucky-input");
const outputs = document.querySelectorAll(".out");
const info = document.getElementById("info");
const history = document.getElementById("history");

// Betting DOM elements
const initialCapitalInput = document.getElementById("initialCapital");
const currentCapitalDisplay = document.getElementById("currentCapital");
const profitDisplay = document.getElementById("profitDisplay");
const startBettingBtn = document.getElementById("startBetting");
const setCapitalBtn = document.getElementById("setCapital");
const gameStatusDisplay = document.getElementById("gameStatus");
const bettingHistoryPanel = document.getElementById("bettingHistory");
const multiplierInputs = document.querySelectorAll(".multiplier-input");





// Bit conversion helpers
function bitsToNum(bits) {
  return bits.reduce((a, b) => (a << 1) | b, 0);
}

function numToBits(n) {
  return Array.from({ length: 5 }, (_, i) => (n >> (4 - i)) & 1);
}

// Function to flip exactly 2 random bits
function flipTwoBits(bits) {
  const bitsArray = bits.split('');
  const flippedIndices = [];
  
  // Choose 2 different random positions
  for (let i = 0; i < 2; i++) {
    let index;
    do {
      index = Math.floor(Math.random() * 5);
    } while (flippedIndices.includes(index));
    flippedIndices.push(index);
    bitsArray[index] = bitsArray[index] === '0' ? '1' : '0';
  }
  
  return {
    result: bitsArray.join(''),
    flippedPositions: flippedIndices.map(i => i + 1),
    originalBits: bits
  };
}

// Enigma machine variables and functions
let step = 0;
let totalOps = 0;
let currentMode = 'ecb';
let operationHistory = [];
let previousCipher = 0;

// Initialize enigma state
function initState() {
  // Initialize rotors, keys, etc.
  step = 0;
  totalOps = 0;
  operationHistory = [];
}

// Update key schedule
function updateKeySchedule() {
  // Update rotor positions and key schedule
  // Simplified implementation
}

// Process with selected mode
function processWithMode(x) {
  const rounds = parseInt(document.getElementById('rounds').value) || 3;
  return processRounds(x, rounds);
}

// Process encryption rounds
function processRounds(x, rounds = 3) {
  let result = x;
  for (let i = 0; i < rounds; i++) {
    result = (result * 7 + i) & 31; // Simplified round function
  }
  return result;
}

// Update statistics
function updateStats() {
  document.getElementById('totalOps').textContent = totalOps;
  document.getElementById('cycles').textContent = step;
  document.getElementById('diffusion').textContent = '85%'; // Simplified
}

// Initialize rotor display
function initRotorDisplay() {
  const rotorGrid = document.getElementById('rotorGrid');
  if (rotorGrid) {
    rotorGrid.innerHTML = '';
    for (let i = 1; i <= 10; i++) {
      const rotorItem = document.createElement('div');
      rotorItem.className = 'rotor-item';
      rotorItem.innerHTML = `
        <div class="rotor-name">Rotor ${i}</div>
        <div class="rotor-value">${Math.floor(Math.random() * 32).toString(16).toUpperCase().padStart(2, '0')}</div>
      `;
      rotorGrid.appendChild(rotorItem);
    }
  }
}



 
 
// Add to history
function addToHistory(message) {
  const timestamp = new Date().toLocaleTimeString();
  const historyItem = `[${timestamp}] ${message}`;
  operationHistory.unshift(historyItem);
  
  if (operationHistory.length > 10) {
    operationHistory.pop();
  }
  
  history.innerHTML = operationHistory.map(item => 
    `<div class="history-item">${item}</div>`
  ).join('');
}

// Betting system functions
function formatCurrency(amount) {
  return amount.toLocaleString('vi-VN');
}

function formatCurrencyWithSeparator(amount) {
  // Format Ä‘Ãºng chuáº©n Viá»‡t Nam: má»—i 3 sá»‘ cÃ³ 1 dáº¥u cháº¥m
  return amount.toLocaleString('vi-VN');
}

function updateCapitalDisplay() {
  currentCapitalDisplay.textContent = formatCurrencyWithSeparator(currentCapital);
  
  // Hiá»ƒn thá»‹ lÃ£i cá»§a round hiá»‡n táº¡i
  profitDisplay.textContent = (roundProfit >= 0 ? '+' : '') + formatCurrencyWithSeparator(roundProfit);
  
  // Update profit display styling
  profitDisplay.classList.remove('positive', 'negative');
  if (roundProfit > 0) {
    profitDisplay.classList.add('positive');
  } else if (roundProfit < 0) {
    profitDisplay.classList.add('negative');
  }
  
  // Kiá»ƒm tra ngÆ°á»¡ng lÃ£i 20%
  const totalProfit = currentCapital - initialCapital;
  const profitPercentage = (totalProfit / initialCapital) * 100;
  
  if (profitPercentage >= 20 && !profitThresholdReached && bettingActive) {
    profitThresholdReached = true;
    bettingActive = false;
    
    // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o
    gameStatusDisplay.textContent = 'ğŸ‰ Perfect!!!ğŸ‰ Perfect!!!ğŸ‰ Perfect!!! HÃ£y dá»«ng láº¡i Ä‘Ãºng lÃºc - Tham lam lÃ  máº¥t háº¿t Ä‘áº¥y @-@';
    gameStatusDisplay.classList.remove('play-prompt', 'warning');
    gameStatusDisplay.classList.add('success-pulse');
    gameStatusDisplay.style.border = '3px solid #10b981';
    gameStatusDisplay.style.color = '#ffffff';
    gameStatusDisplay.style.fontSize = '1.4em';
    
    // ThÃ´ng bÃ¡o trÃ¬nh duyá»‡t
    if (Notification.permission === "granted") {
      new Notification("ğŸ‰ Má»¥c TiÃªu Äáº¡t ÄÆ°á»£c!", {
        body: `LÃ£i ${formatCurrencyWithSeparator(totalProfit)} (${profitPercentage.toFixed(1)}%) - HÃ´m nay nhÆ° tháº¿ lÃ  Ä‘á»§ rá»“i!`,
        icon: "ğŸ¯",
        requireInteraction: true
      });
    } else if (Notification.permission !== "denied") {
      Notification.requestPermission().then(permission => {
        if (permission === "granted") {
          new Notification("ğŸ‰ Má»¥c TiÃªu Äáº¡t ÄÆ°á»£c!", {
            body: `LÃ£i ${formatCurrencyWithSeparator(totalProfit)} (${profitPercentage.toFixed(1)}%) - HÃ´m nay nhÆ° tháº¿ lÃ  Ä‘á»§ rá»“i!`,
            icon: "ğŸ¯",
            requireInteraction: true
          });
        }
      });
    }
    
    addToBettingHistory(`ğŸ‰ Äáº¡t ngÆ°á»¡ng lÃ£i 20%! THU Vá»€: ${formatCurrencyWithSeparator(totalProfit)} - PERFECT`, true);
    addToHistory(`Profit threshold reached: ${formatCurrencyWithSeparator(totalProfit)} (${profitPercentage.toFixed(1)}%)`);
  }
  
  if (currentCapital <= 0) {
    gameStatusDisplay.textContent = 'ğŸ’” Háº¿t tÃªn lá»­a - Báº N ÄÃƒ XANH Cá» XIN CHÃšC Má»ªNG!';
    gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(185, 28, 28, 0.2))';
    bettingActive = false;
  }
}

function addToBettingHistory(message, isWin = null) {
  const timestamp = new Date().toLocaleTimeString();
  const historyItem = document.createElement('div');
  historyItem.className = 'bet-history-item';
  if (isWin === true) historyItem.classList.add('win');
  if (isWin === false) historyItem.classList.add('lose');
  historyItem.textContent = `[${timestamp}] ${message}`;
  
  bettingHistoryPanel.insertBefore(historyItem, bettingHistoryPanel.firstChild);
  
  if (bettingHistoryPanel.children.length > 10) {
    bettingHistoryPanel.removeChild(bettingHistoryPanel.lastChild);
  }
}

function setCapital() {
  // Parse giÃ¡ trá»‹ tá»« input, loáº¡i bá» dáº¥u cháº¥m vÃ  dáº¥u pháº©y
  const capitalValue = parseInt(initialCapitalInput.value.replace(/[.,]/g, '')) || 10000000;
  
  if (capitalValue < 1000) {
    gameStatusDisplay.textContent = 'âš ï¸ Sá»‘ lÆ°á»£ng tÃªn lá»­a tá»‘i thiá»ƒu lÃ  1,000';
    gameStatusDisplay.classList.add('warning');
    setTimeout(() => {
      gameStatusDisplay.classList.remove('warning');
      gameStatusDisplay.textContent = 'ğŸ® Báº¤M NÃšT "PLAY" Ä‘á»ƒ Báº®T Äáº¦U chiáº¿n Ä‘áº¥u!';
      gameStatusDisplay.classList.add('play-prompt');
    }, 3000);
    return;
  }
  
  // Cho phÃ©p tÄƒng vá»‘n cáº£ khi Ä‘ang chÆ¡i vÃ  khi chÆ°a chÆ¡i
  if (!bettingActive) {
    // ChÆ°a chÆ¡i - cáº­p nháº­t vá»‘n ban Ä‘áº§u vÃ  vá»‘n hiá»‡n táº¡i
    initialCapital = capitalValue;
    currentCapital = capitalValue;
    roundProfit = 0; // Reset lÃ£i round
    updateCapitalDisplay();
    
    // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o thÃ nh cÃ´ng
    gameStatusDisplay.textContent = `ğŸ’° ÄÃ£ nháº­p Sá»‘ lÆ°á»£ng tÃªn lá»­a: ${formatCurrencyWithSeparator(capitalValue)} - Vui lÃ²ng nháº­p Tá»‘c Ä‘á»™ tÃªn lá»­a`;
    gameStatusDisplay.classList.remove('warning');
    gameStatusDisplay.classList.add('bet-prompt', 'wide-notification');
    gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.2))';
    gameStatusDisplay.style.border = '2px solid rgba(245, 158, 11, 0.5)';
    gameStatusDisplay.style.color = '#f59e0b';
    
    // Ngá»«ng nháº¥p nhÃ¡y nÃºt nháº­p vá»‘n
    setCapitalBtn.classList.remove('capital-button-pulse');
    
    // Enable multiplier inputs khi nháº­p vá»‘n thÃ nh cÃ´ng
    multiplierInputs.forEach(inp => inp.disabled = false);
    
    addToBettingHistory(`Nháº­p Sá»‘ lÆ°á»£ng tÃªn lá»­a: ${formatCurrencyWithSeparator(capitalValue)}`);
    addToHistory(`Capital set to: ${formatCurrencyWithSeparator(capitalValue)}`);
    
    // Focus ngay láº­p tá»©c vÃ o Ã´ má»©c cÆ°á»£c Ä‘áº§u tiÃªn
    document.getElementById('mult1').focus();
  } else {
    // Äang chÆ¡i - chá»‰ tÄƒng vá»‘n hiá»‡n táº¡i, khÃ´ng thay Ä‘á»•i vá»‘n ban Ä‘áº§u
    if (capitalValue > currentCapital) {
      const capitalIncrease = capitalValue - currentCapital;
      currentCapital = capitalValue;
      updateCapitalDisplay();
      
      // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o tÄƒng vá»‘n thÃ nh cÃ´ng
      gameStatusDisplay.textContent = `ğŸ’° ÄÃ£ tÄƒng Sá»‘ lÆ°á»£ng tÃªn lá»­a: +${formatCurrencyWithSeparator(capitalIncrease)} - Vui lÃ²ng nháº­p Tá»‘c Ä‘á»™ TÃªn lá»­a`;
      gameStatusDisplay.classList.remove('warning');
      gameStatusDisplay.classList.add('bet-prompt', 'wide-notification');
      gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.2))';
      gameStatusDisplay.style.border = '2px solid rgba(245, 158, 11, 0.5)';
      gameStatusDisplay.style.color = '#f59e0b';
      
      // Ngá»«ng nháº¥p nhÃ¡y nÃºt nháº­p vá»‘n
      setCapitalBtn.classList.remove('capital-button-pulse');
      
      addToBettingHistory(`TÄƒng Sá»‘ lÆ°á»£ng tÃªn lá»­a: +${formatCurrencyWithSeparator(capitalIncrease)} - Sá»‘ lÆ°á»£ng tÃªn lá»­a má»›i: ${formatCurrencyWithSeparator(currentCapital)}`);
      addToHistory(`Capital increased by: ${formatCurrencyWithSeparator(capitalIncrease)}`);
      
      // Focus ngay láº­p tá»©c vÃ o Ã´ input má»©c cÆ°á»£c Ä‘áº§u tiÃªn
      document.getElementById('mult1').focus();
    } else if (capitalValue < currentCapital) {
      // KhÃ´ng cho phÃ©p giáº£m vá»‘n khi Ä‘ang chÆ¡i
      gameStatusDisplay.textContent = 'âš ï¸ KhÃ´ng thá»ƒ giáº£m Sá»‘ lÆ°á»£ng tÃªn lá»­a khi Ä‘ang chiáº¿n Ä‘áº¥u! Chá»‰ cÃ³ thá»ƒ tÄƒng Sá»‘ lÆ°á»£ng tÃªn lá»­a.';
      gameStatusDisplay.classList.add('warning');
      setTimeout(() => {
        gameStatusDisplay.classList.remove('warning');
        gameStatusDisplay.textContent = 'ğŸ® Äang chiáº¿n Ä‘áº¥u - Nháº­p tá»a Ä‘á»™ Ä‘á»ƒ báº¯t Ä‘áº§u';
      }, 3000);
    } else {
      // Vá»‘n khÃ´ng Ä‘á»•i
      gameStatusDisplay.textContent = 'ğŸ’° Sá»‘ lÆ°á»£ng tÃªn lá»­a khÃ´ng thay Ä‘á»•i - Vui lÃ²ng nháº­p Tá»a Ä‘á»™ TÃªn lá»­a';
      gameStatusDisplay.classList.remove('warning');
      gameStatusDisplay.classList.add('bet-prompt');
      gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(251, 191, 36, 0.2))';
      gameStatusDisplay.style.border = '2px solid rgba(245, 158, 11, 0.5)';
      gameStatusDisplay.style.color = '#f59e0b';
      
      // Focus ngay láº­p tá»©c vÃ o Ã´ input má»©c cÆ°á»£c Ä‘áº§u tiÃªn
      document.getElementById('mult1').focus();
    }
  }
}

function startBetting() {
  // Parse giÃ¡ trá»‹ tá»« input, loáº¡i bá» dáº¥u cháº¥m
  const initialCapitalValue = parseInt(initialCapitalInput.value.replace(/\./g, '')) || 10000000;
  if (initialCapitalValue < 1000) {
    gameStatusDisplay.textContent = 'âš ï¸ Sá»‘ lÆ°á»£ng tÃªn lá»­a tá»‘i thiá»ƒu lÃ  1,000';
    gameStatusDisplay.classList.add('warning');
    setTimeout(() => {
      gameStatusDisplay.classList.remove('warning');
      gameStatusDisplay.textContent = 'ğŸ® Báº¤M NÃšT "PLAY" Ä‘á»ƒ Báº®T Äáº¦U chiáº¿n Ä‘áº¥u!';
      gameStatusDisplay.classList.add('play-prompt');
    }, 3000);
    return;
  }
  
  initialCapital = initialCapitalValue;
  currentCapital = initialCapitalValue;
  bettingActive = true;
  currentBetRound = 0;
  profitThresholdReached = false; // Reset flag khi báº¯t Ä‘áº§u game má»›i
  updateCapitalDisplay();
  
  // Enable input fields
  inputs.forEach(inp => inp.classList.remove('disabled'));
  
  // Auto focus vÃ o Ã´ input Ä‘áº§u tiÃªn
  inputs[0].focus();
  
  // Táº¯t animation nÃºt Play
  startBettingBtn.classList.remove('play-pulse');
  
  // Táº¯t thÃ´ng bÃ¡o nháº¥p nhÃ¡y vÃ  hiá»ƒn thá»‹ tráº¡ng thÃ¡i chÆ¡i
  gameStatusDisplay.classList.remove('play-prompt', 'warning');
  gameStatusDisplay.textContent = 'ğŸ® Äang chiáº¿n Ä‘áº¥u - Nháº­p tá»a Ä‘á»™ Ä‘á»ƒ báº¯t Ä‘áº§u';
  gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1))';
  gameStatusDisplay.style.border = '2px solid rgba(245, 158, 11, 0.3)';
  gameStatusDisplay.style.color = '#e2e8f0';
  gameStatusDisplay.style.fontSize = '1.2em';
  
  addToBettingHistory('Báº¯t Ä‘áº§u chiáº¿n Ä‘áº¥u vá»›i Sá»‘ lÆ°á»£ng tÃªn lá»­a: ' + formatCurrencyWithSeparator(currentCapital));
  addToHistory('Game started with capital: ' + formatCurrencyWithSeparator(currentCapital));
}

function processBetting(inputVals, outputVals) {
  if (!bettingActive) return;
  
  currentBetRound++;
  const multipliers = Array.from(multiplierInputs).map(input => parseInt(input.value) || 1);
  const totalBet = multipliers.reduce((sum, mult) => sum + (mult * 1000), 0);
  
  // Kiá»ƒm tra vá»‘n cÃ²n Ä‘á»§ Ä‘á»ƒ cÆ°á»£c khÃ´ng
  if (currentCapital < totalBet) {
    gameStatusDisplay.textContent = `ğŸ’” Sá»‘ lÆ°á»£ng tÃªn lá»­a khÃ´ng Ä‘á»§ Ä‘á»ƒ chiáº¿n Ä‘áº¥u! Cáº§n ${formatCurrencyWithSeparator(totalBet)}, cÃ²n ${formatCurrencyWithSeparator(currentCapital)}. Vui lÃ²ng reset game Ä‘á»ƒ vÃ o váº¡ch xuáº¥t phÃ¡t!`;
    gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.3), rgba(251, 191, 36, 0.3))';
    gameStatusDisplay.style.border = '2px solid #f59e0b';
    gameStatusDisplay.style.color = '#ffffff';
    gameStatusDisplay.classList.add('warning', 'insufficient-funds-pulse');
    bettingActive = false;
    addToBettingHistory(`Háº¿t tÃªn lá»­a rá»“i- Cáº§n ${formatCurrencyWithSeparator(totalBet)} kg, hiá»‡n táº¡i chá»‰ cÃ³ ${formatCurrencyWithSeparator(currentCapital)} - YÃªu cáº§u reset game trá»Ÿ vá» váº¡ch xuáº¥t phÃ¡t`, false);
    return;
  }
  
  let totalDeducted = 0;
  let matchFound = false;
  let matchPosition = -1;
  
  // Reset lÃ£i round má»›i
  roundProfit = 0;
  
  console.log('Processing betting round', currentBetRound, 'multipliers:', multipliers);
  
  // Láº¥y giÃ¡ trá»‹ tá»« lucky inputs
  const luckyVals = Array.from(luckyInputs).map(input => input.value);
  
  // Check tá»«ng bit tá»« 1-5
  for (let i = 0; i < 5; i++) {
    if (luckyVals[i] !== "") {
      const betAmount = baseBetAmount * multipliers[i];
      
      console.log(`Bit ${i + 1}: lucky=${luckyVals[i]}, output=${outputVals[i]}, bet=${betAmount}`);
      
      if (luckyVals[i] === outputVals[i]) {
        // CÃ³ match - cá»™ng 80% vÃ  TIáº¾P Tá»¤C CHÆ I (khÃ´ng dá»«ng)
        matchFound = true;
        matchPosition = i;
        const winAmount = Math.floor(betAmount * 0.8);
        currentCapital += winAmount;
        roundProfit += winAmount; // Cá»™ng vÃ o lÃ£i round
        
        console.log(`MATCH at position ${i + 1}! Win amount: ${winAmount}`);
        
        gameStatusDisplay.textContent = `ğŸ‰ TrÃºng má»¥c tiÃªu! +${formatCurrencyWithSeparator(winAmount)} táº¡i vá»‹ trÃ­ ${i + 1} - Tiáº¿p tá»¥c vÃ²ng ${currentBetRound + 1}`;
        addToBettingHistory(`TrÃºng má»¥c tiÃªu ${formatCurrencyWithSeparator(winAmount)} táº¡i vá»‹ trÃ­ ${i + 1} - Sá»‘ lÆ°á»£ng tÃªn lá»­a: ${formatCurrencyWithSeparator(currentCapital)} - Tiáº¿p tá»¥c chiáº¿n Ä‘áº¥u`, true);
        
        // Highlight match
        luckyInputs[i].classList.add('match');
        
        // KHÃ”NG dá»«ng betting - tiáº¿p tá»¥c chÆ¡i
        break;
      } else {
        // KhÃ´ng match - trá»« tiá»n
        currentCapital -= betAmount;
        totalDeducted += betAmount;
        roundProfit -= betAmount; // Trá»« vÃ o lÃ£i round
        
        console.log(`NO MATCH at position ${i + 1}. Deducting: ${betAmount}`);
        
        gameStatusDisplay.textContent = `âŒ Bit ${i + 1} khÃ´ng trÃ¹ng - Trá»« ${formatCurrencyWithSeparator(betAmount)} - VÃ²ng ${currentBetRound}`;
        addToBettingHistory(`Bit ${i + 1} khÃ´ng trÃ¹ng - Trá»« ${formatCurrencyWithSeparator(betAmount)} - Sá»‘ lÆ°á»£ng tÃªn lá»­a: ${formatCurrencyWithSeparator(currentCapital)}`, false);
        
        // Kiá»ƒm tra háº¿t vá»‘n
        if (currentCapital <= 0) {
          bettingActive = false;
          gameStatusDisplay.textContent = 'ğŸ’” Háº¿t TÃŠN Lá»¬A rá»“i - Báº¡n váº«n cÃ²n thá»Ÿ chá»© !';
          break;
        }
      }
    }
  }
  
  updateCapitalDisplay();
  
  // Xá»­ lÃ½ logic focus vÃ  reset theo nguá»“n gá»i
  if (bettingActive && fromLuckyInputs) {
    // reset toÃ n bá»™ input
    inputs.forEach(input => input.value = "");

    // GIá»® Láº I 5 Ã´ tá»a Ä‘á»™, khÃ´ng reset á»Ÿ Ä‘Ã¢y
    // luckyInputs.forEach(i => {
    //   i.value = "";
    //   i.classList.remove('match');
    // });

    // focus CHá»ˆ 1 NÆ I
    inputs[0].focus();

    fromLuckyInputs = false;
  } else {
    // KHÃ”NG reset tá»a Ä‘á»™ á»Ÿ Ä‘Ã¢y - chá»‰ reset khi gá»i tá»« compute (sau khi nháº­p Ã´ 5 input)
    // if (bettingActive && currentCapital > 0) {
    //   setTimeout(() => {
    //     luckyInputs.forEach(i => {
    //       i.value = "";
    //       i.classList.remove('match');
    //     });
    //     luckyInputs[0].focus();
    //     gameStatusDisplay.textContent = `ğŸ® VÃ²ng ${currentBetRound + 1} - Nháº­p Tá»ŒA Äá»˜ may máº¯n tiáº¿p theo`;
    //   }, 1500);
    // }
  }
  
  console.log('Final capital:', currentCapital, 'Betting active:', bettingActive, 'Round profit:', roundProfit);
}

// Auto-processing function
function autoCompute() {
  const vals = [...inputs].map(i => i.value);
  if (vals.some(v => v === "")) return;

  let x = bitsToNum(vals.map(Number));
  step++;
  totalOps++;
  
  // Update key schedule
  updateKeySchedule();
  
  // Process with selected mode
  let result = processWithMode(x);
  
  const out = numToBits(result & 31);
  out.forEach((b, i) => outputs[i].value = b);
  
  // Update displays
  updateStats();
  
  const hexOutput = result.toString(16).toUpperCase();
  info.textContent = `ğŸ”¢ Step ${step} | Auto-Processed: ${hexOutput} | Mode: ${currentMode.toUpperCase()} | Rounds: ${document.getElementById('rounds').value}`;
  
  addToHistory(`Auto ${vals.join('')} â†’ ${out.join('')} (0x${hexOutput})`);
}

// Compare auto inputs with outputs and highlight matches
function compareAndHighlight() {
  const autoVals = [...autoOuts].map(i => i.value);
  const outputVals = [...outputs].map(i => i.value);
  
  // Remove all match classes first
  autoOuts.forEach(input => input.classList.remove('match'));
  
  // Check for matches and highlight
  autoVals.forEach((autoVal, index) => {
    if (autoVal !== "" && autoVal === outputVals[index]) {
      autoOuts[index].classList.add('match');
    }
  });
}

// Main encryption/decryption function
function compute(encryptMode = true) {
  const vals = [...inputs].map(i => i.value);
  if (vals.some(v => v === "")) return;

  let x = bitsToNum(vals.map(Number));
  step++;
  totalOps++;
  
  // Update key schedule
  updateKeySchedule();
  
  // Process with selected mode
  let result = processWithMode(x);
  
  if (!encryptMode) {
    // For decryption, we'd need to reverse the process
    // This is simplified - real decryption would require storing states
    result = processRounds(x ^ 0x55555); // Simple reverse example
  }
  
  const out = numToBits(result & 31);
  
  // Apply 2-bit flipping transformation for encryption
  let flipResult = null;
  if (encryptMode) {
    const inputBits = vals.join('');
    flipResult = flipTwoBits(inputBits);
    const finalBits = flipResult.result.split('');
    
    // Use the flipped bits as output
    finalBits.forEach((b, i) => outputs[i].value = b);
    
    // Update displays with flip information
    updateStats();
    
    const modeText = 'Encrypted + 2-Bit Flip';
    const hexOutput = result.toString(16).toUpperCase();
    info.textContent = `ğŸ”¢ Step ${step} | ${modeText}: ${finalBits.join('')} | Flipped: ${flipResult.flippedPositions.join(',')} | Original: ${inputBits}`;
    
    addToHistory(`${modeText} ${inputBits} â†’ ${finalBits.join('')} (flipped positions: ${flipResult.flippedPositions.join(',')})`);
  } else {
    // Regular decryption output
    out.forEach((b, i) => outputs[i].value = b);
    
    // Update displays
    updateStats();
    
    const modeText = 'Decrypted';
    const hexOutput = result.toString(16).toUpperCase();
    info.textContent = `ğŸ”¢ Step ${step} | ${modeText}: ${hexOutput} | Mode: ${currentMode.toUpperCase()} | Rounds: ${document.getElementById('rounds').value}`;
    
    addToHistory(`${modeText} ${vals.join('')} â†’ ${out.join('')} (0x${hexOutput})`);
  }
  
  // Compare and highlight matches after encryption
  if (autoOuts[0].value !== "") {
    compareAndHighlight();
  }
  
  // Process betting if active
  if (bettingActive && encryptMode && flipResult) {
    const finalBits = flipResult.result.split('');
    processBetting(vals, finalBits);
    
    // CHá»ˆ reset tá»a Ä‘á»™ sau khi nháº­p Ã´ 5 input
    setTimeout(() => {
      luckyInputs.forEach(i => {
        i.value = "";
        i.classList.remove('match');
      });
      luckyInputs[0].focus();
      gameStatusDisplay.textContent = `ğŸ® VÃ²ng ${currentBetRound + 1} - Nháº­p Tá»ŒA Äá»˜ may máº¯n tiáº¿p theo`;
    }, 1500);
  } else if (bettingActive && !encryptMode) {
    // For decryption, use regular output
    const finalBits = out;
    processBetting(vals, finalBits);
    
    // CHá»ˆ reset tá»a Ä‘á»™ sau khi nháº­p Ã´ 5 input
    setTimeout(() => {
      luckyInputs.forEach(i => {
        i.value = "";
        i.classList.remove('match');
      });
      luckyInputs[0].focus();
      gameStatusDisplay.textContent = `ğŸ® VÃ²ng ${currentBetRound + 1} - Nháº­p Tá»ŒA Äá»˜ may máº¯n tiáº¿p theo`;
    }, 1500);
  }
}

// Reset function
function softReset() {
  inputs.forEach(i => i.value = "");
  autoOuts.forEach(i => {
    i.value = "";
    i.classList.remove('match');
  });
  outputs.forEach(o => o.value = "");
  previousCipher = 0;
  info.textContent = "Advanced Enigma Ready - 10 Rotors Active";
  
  // Reset betting system - báº¯t Ä‘áº§u láº¡i tá»« Ä‘áº§u
  bettingActive = false;
  currentBetRound = 0;
  roundProfit = 0;
  initialCapital = 0;
  currentCapital = 0;
  updateCapitalDisplay();
  
  // XÃ³a giÃ¡ trá»‹ trong Ã´ nháº­p vá»‘n
  initialCapitalInput.value = "";
  
  // Disable input fields
  inputs.forEach(inp => inp.classList.add('disabled'));
  
 
  
  // Táº¯t animation nÃºt Play
  startBettingBtn.classList.remove('play-pulse');
  
  // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o yÃªu cáº§u nháº­p vá»‘n
  gameStatusDisplay.classList.remove('warning', 'play-prompt', 'bet-prompt');
  gameStatusDisplay.textContent = 'ğŸ’° Vui lÃ²ng nháº­p Sá»‘ lÆ°á»£ng tÃªn lá»­a Ä‘á»ƒ báº¯t Ä‘áº§u';
  gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.1))';
  gameStatusDisplay.style.border = '2px solid rgba(245, 158, 11, 0.3)';
  gameStatusDisplay.style.color = '#e2e8f0';
  gameStatusDisplay.style.fontSize = '1.2em';
  
  // Focus vÃ o Ã´ input vá»‘n ban Ä‘áº§u vÃ  thÃªm láº¡i hiá»‡u á»©ng nháº¥p nhÃ¡y
  initialCapitalInput.focus();
  initialCapitalInput.classList.add('cursor-blink-active');
  
  // Clear betting history
  bettingHistoryPanel.innerHTML = '<div class="bet-history-item">Há»‡ thá»‘ng tÃªn lá»­a Ä‘Ã£ sáºµn sÃ ng</div>';
  
  addToHistory('System reset - Betting game reset - Ready for new operation');
}

  

// Event listener for initial capital input
initialCapitalInput.addEventListener('input', () => {
  // Format sá»‘ tiá»n khi nháº­p
  const value = parseInt(initialCapitalInput.value.replace(/\./g, '')) || 0;
  if (value >= 1000) {
    initialCapitalInput.value = formatCurrencyWithSeparator(value);
  }
});

initialCapitalInput.addEventListener('focus', () => {
  // XÃ³a format Ä‘á»ƒ user nháº­p sá»‘ má»›i
  const value = parseInt(initialCapitalInput.value.replace(/\./g, '')) || 0;
  initialCapitalInput.value = value;
  // XÃ³a hiá»‡u á»©ng nháº¥p nhÃ¡y khi user focus vÃ o Ã´
  initialCapitalInput.classList.remove('cursor-blink-active');
});

initialCapitalInput.addEventListener('blur', () => {
  // Format láº¡i khi máº¥t focus
  const value = parseInt(initialCapitalInput.value) || 0;
  if (value >= 1000) {
    initialCapitalInput.value = formatCurrencyWithSeparator(value);
  }
});

// XÃ³a hiá»‡u á»©ng nháº¥p nhÃ¡y khi user báº¯t Ä‘áº§u nháº­p
initialCapitalInput.addEventListener('input', () => {
  initialCapitalInput.classList.remove('cursor-blink-active');
});

// Event listeners for main inputs
inputs.forEach((inp, idx) => {
  inp.addEventListener("input", () => {
    // Chá»‰ cho phÃ©p nháº­p khi betting Ä‘Ã£ Ä‘Æ°á»£c kÃ­ch hoáº¡t
    if (!bettingActive) {
      inp.value = "";
      
      // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o ná»•i báº­t
      gameStatusDisplay.textContent = 'âš ï¸ VUI LÃ’NG Báº¤M "PLAY" TRÆ¯á»šC KHI NHáº¬P Tá»ŒA Äá»˜ !';
      gameStatusDisplay.classList.add('warning');
      
      // ThÃ´ng bÃ¡o trÃ¬nh duyá»‡t
      if (Notification.permission === "granted") {
        new Notification("Enigma Betting", {
          body: "Vui lÃ²ng báº¥m 'Play' trÆ°á»›c khi nháº­p Tá»a Ä‘á»™ !",
          icon: "âš ï¸",
          requireInteraction: true
        });
      } else if (Notification.permission !== "denied") {
        Notification.requestPermission().then(permission => {
          if (permission === "granted") {
            new Notification("Enigma Betting", {
              body: "Vui lÃ²ng báº¥m 'Play' trÆ°á»›c khi nháº­p Tá»a Ä‘á»™ !",
              icon: "âš ï¸",
              requireInteraction: true
            });
          }
        });
      }
      
      // Tá»± Ä‘á»™ng táº¯t sau 3 giÃ¢y
      setTimeout(() => {
        gameStatusDisplay.classList.remove('warning');
        gameStatusDisplay.textContent = 'ğŸ® Báº¤M NÃšT "PLAY" Äá»‚ Báº®T Äáº¦U CHIáº¾N Äáº¤U!';
        gameStatusDisplay.classList.add('play-prompt');
      }, 3000);
      return;
    }
    
    if (inp.value !== "0" && inp.value !== "1") {
      inp.value = "";
      return;
    }
    
    // KHÃ”NG reset lucky inputs khi nháº­p Ã´ 1 - chá»‰ reset sau khi nháº­p Ã´ 5 input
    // if (idx === 0) {
    //   luckyInputs.forEach(luckyInput => {
    //     luckyInput.value = "";
    //     luckyInput.classList.remove('match');
    //   });
    // }
    
    // Auto-focus sang Ã´ tiáº¿p theo khi nháº­p xong
    if (idx < inputs.length - 1)
      inputs[idx + 1].focus();
    
    // Auto-trigger encryption when all 5 bits are entered
    if (idx === inputs.length - 1 && inp.value !== "") {
      setTimeout(() => compute(true), 100);
    }
  });

  inp.addEventListener("keydown", e => {
    if (e.key === "Backspace" && inp.value === "" && idx > 0)
      inputs[idx - 1].focus();
  });
});



// Betting system event listeners
startBettingBtn.onclick = startBetting;
setCapitalBtn.onclick = setCapital;

// Multiplier input validation vÃ  auto-focus
multiplierInputs.forEach((input, index) => {
  input.addEventListener('input', () => {
    // Cho phÃ©p giÃ¡ trá»‹ báº¥t ká»³, chá»‰ Ä‘áº£m báº£o khÃ´ng rá»—ng
    let value = parseInt(input.value) || 0;
    if (value < 0) value = 0; // Chá»‰ Ä‘áº£m báº£o khÃ´ng Ã¢m
    input.value = value;
    
    // Náº¿u Ã´ Ä‘Ã£ cÃ³ giÃ¡ trá»‹, tá»± Ä‘á»™ng focus sang Ã´ tiáº¿p theo sau 2 giÃ¢y
    if (input.value !== '' && input.value !== '0' && index < multiplierInputs.length - 1) {
      setTimeout(() => {
        multiplierInputs[index + 1].focus();
      }, 2000);
    }
    
    // Kiá»ƒm tra náº¿u nháº­p xong Ã´ sá»‘ 5 vÃ  táº¥t cáº£ Ã´ Ä‘á»u cÃ³ giÃ¡ trá»‹
    if (index === multiplierInputs.length - 1 && input.value !== '' && input.value !== '0') {
      // Kiá»ƒm tra táº¥t cáº£ cÃ¡c Ã´ Ä‘á»u Ä‘Ã£ cÃ³ giÃ¡ trá»‹
      const allFilled = [...multiplierInputs].every(inp => inp.value !== '' && inp.value !== '0');
      
      if (allFilled) {
        // KÃ­ch hoáº¡t nÃºt Play nháº¥p nhÃ¡y
        startBettingBtn.classList.add('play-pulse');
        
        // Hiá»ƒn thá»‹ thÃ´ng bÃ¡o báº¥m Play Ä‘á»ƒ báº¯t Ä‘áº§u chÆ¡i
        gameStatusDisplay.textContent = 'ğŸ® Báº¤M NÃšT "PLAY" Ä‘á»ƒ phÃ³ng TÃªn Lá»­a !';
        gameStatusDisplay.classList.remove('warning', 'bet-prompt');
        gameStatusDisplay.classList.add('play-prompt');
        gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(29, 78, 216, 0.3))';
        gameStatusDisplay.style.border = '3px solid #3b82f6';
        gameStatusDisplay.style.color = '#ffffff';
        gameStatusDisplay.style.fontSize = '1.3em';
        
        // Focus vÃ o nÃºt Play
        setTimeout(() => {
          startBettingBtn.focus();
        }, 1000);
      }
    }
  });
});

// Event listeners for lucky inputs (Tá»ŒA Äá»˜ may máº¯n)
luckyInputs.forEach((inp, idx) => {
  inp.addEventListener("input", () => {
    // Chá»‰ cho phÃ©p nháº­p 0 hoáº·c 1
    if (inp.value !== "0" && inp.value !== "1") {
      inp.value = "";
      return;
    }
    
    // Auto-focus to next field
    if (idx < luckyInputs.length - 1) {
      luckyInputs[idx + 1].focus();
    }
    
    // Auto-trigger betting comparison when all 5 bits are entered
    if (idx === luckyInputs.length - 1 && inp.value !== "") {
      setTimeout(() => {
        const luckyVals = Array.from(luckyInputs).map(i => i.value);
        const outputVals = Array.from(outputs).map(o => o.value);

        if (outputVals.every(val => val !== "")) {
          fromLuckyInputs = true;      // ğŸ‘ˆ ÄÃNH Dáº¤U NGUá»’N
          processBetting(luckyVals, outputVals);
        }
      }, 100);
    }
  });

  inp.addEventListener("keydown", e => {
    if (e.key === "Backspace" && inp.value === "" && idx > 0) {
      luckyInputs[idx - 1].focus();
    }
  });
});

// Mode change handler
document.getElementById('mode').addEventListener('change', () => {
  currentMode = document.getElementById('mode').value;
  addToHistory(`Mode changed to ${currentMode.toUpperCase()}`);
});

// Key/IV change handlers
document.getElementById('customKey').addEventListener('change', () => {
  initState();
});

document.getElementById('customIV').addEventListener('change', () => {
  initState();
});

// Reset Game button handler
document.getElementById('reset').addEventListener('click', () => {
  // Reset táº¥t cáº£ biáº¿n game
  currentCapital = 0;
  initialCapital = 0;
  bettingActive = false;
  bettingHistory = [];
  currentBetRound = 0;
  roundProfit = 0;
  profitThresholdReached = false;
  
  // Reset displays
  currentCapitalDisplay.textContent = '0';
  profitDisplay.textContent = '0';
  profitDisplay.classList.remove('positive', 'negative');
  
  // Clear inputs
  multiplierInputs.forEach(input => {
    input.value = '';
    input.disabled = true;
  });
  inputs.forEach(input => {
    input.value = '';
    input.classList.add('disabled');
  });
  luckyInputs.forEach(input => {
    input.value = '';
    input.classList.remove('match');
  });
  outputs.forEach(output => output.value = '');
  autoOuts.forEach(output => output.value = '');
  
  // Reset game status
  gameStatusDisplay.textContent = 'ğŸ’° Vui lÃ²ng nháº­p Sá»‘ lÆ°á»£ng tÃªn lá»­a vÃ o kho !!!';
  gameStatusDisplay.classList.remove('play-prompt', 'warning', 'bet-prompt', 'success-pulse', 'insufficient-funds-pulse', 'wide-notification');
  gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.1))';
  gameStatusDisplay.style.border = '2px solid rgba(245, 158, 11, 0.3)';
  
  // Clear betting history
  bettingHistoryPanel.innerHTML = '<div class="bet-history-item">Há»‡ thá»‘ng chiáº¿n Ä‘áº¥u Ä‘Ã£ sáºµn sÃ ng</div>';
  
  // Reset enigma state
  softReset();
  initState();
  
  // ThÃªm láº¡i class nháº¥p nhÃ¡y cho nÃºt nháº­p vá»‘n
  setCapitalBtn.classList.add('capital-button-pulse');
  
  // Focus on first input
  inputs[0].focus();
});

// Initialize
initRotorDisplay();
initState();
softReset();
updateCapitalDisplay();

// Disable inputs initially
inputs.forEach(inp => inp.classList.add('disabled'));

// Disable multiplier inputs initially
multiplierInputs.forEach(inp => inp.disabled = true);

// Äáº£m báº£o nÃºt Play khÃ´ng nháº¥p nhÃ¡y khi táº£i trang
startBettingBtn.classList.remove('play-pulse');

// ThÃªm class nháº¥p nhÃ¡y cho nÃºt nháº­p vá»‘n khi táº£i trang
setCapitalBtn.classList.add('capital-button-pulse');

// Hiá»ƒn thá»‹ thÃ´ng bÃ¡o hÆ°á»›ng dáº«n nháº­p vá»‘n
gameStatusDisplay.textContent = 'ğŸ’° Vui lÃ²ng nháº­p Sá»‘ lÆ°á»£ng tÃªn lá»­a vÃ o kho';
gameStatusDisplay.classList.remove('play-prompt', 'warning', 'bet-prompt');
gameStatusDisplay.style.background = 'linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(239, 68, 68, 0.1))';
gameStatusDisplay.style.border = '2px solid rgba(245, 158, 11, 0.3)';
gameStatusDisplay.style.color = '#e2e8f0';
gameStatusDisplay.style.fontSize = '1.2em';

// Focus vÃ o Ã´ input vá»‘n ban Ä‘áº§u vá»›i hiá»‡u á»©ng nháº¥p nhÃ¡y
window.addEventListener('load', () => {
  setTimeout(() => {
    initialCapitalInput.focus();
    // ThÃªm hiá»‡u á»©ng nháº¥p nhÃ¡y cho cursor - cháº¡y liÃªn tá»¥c
    initialCapitalInput.classList.add('cursor-blink-active');
  }, 500);
});

// Focus ngay láº­p tá»©c vÃ  thÃªm hiá»‡u á»©ng nháº¥p nhÃ¡y
initialCapitalInput.focus();
initialCapitalInput.classList.add('cursor-blink-active');

// Focus on first input after initialization (only if not disabled)
if (inputs.length > 0 && !inputs[0].classList.contains('disabled')) {
  inputs[0].focus();
}
</script>

</body>
</html>


